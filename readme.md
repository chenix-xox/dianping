## 项目小记

### 缓存更新策略

[<img src="https://s21.ax1x.com/2024/05/23/pkQKRmR.png" alt="pkQKRmR.png" style="zoom: 33%;" />](https://imgse.com/i/pkQKRmR)

业务场景：

- 低一致性需求：使用内存淘汰机制。例如店铺类型的查询缓存

- 高一致性需求：主动更新，并以超时剔除作为兜底方案。例如店铺详情查询的缓存



#### 主动更新策略

1. 【推荐】缓存的调用者，在更新数据库的同时更新缓存

   > **详解：**
   >
   > 之考虑三个问题（更新数据库时）
   >
   > 1. **删除缓存还是更新缓存？**
   >
   >    - 更新缓存：每次更新数据库都更新缓存，无效写入较多
   >    - 【推荐】删除缓存：更新数据库时让缓存失效，查询时再更新
   >
   > 2. **如何保证缓存与数据库的操作同时成功or失败？**
   >
   >    - 单体系统：将缓存与数据库操作放在一个事务里
   >    - 分布式系统：利用TCC等分布式事务方案
   >
   > 3. **先操作缓存还是先操作数据库？**
   >
   >    ​	....

2. 缓存与数据库整合为一个服务，由服务维护一致性。

   调用者调用该服务即可

3. 调用者只操作缓存，将缓存数据持久化到数据库由**其他线程异步执行**



### 缓存穿透

客户端请求的数据在缓存和数据库都不存在，缓存永远无法生效，请求都会打到数据库 

**解决方案：**

1. 缓存空对象

   简单、维护方便；但是会造成额外的内存消耗及短期的不一致

2. 布隆过滤器



